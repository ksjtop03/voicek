#######################################################################################################
#########################################         기타         ########################################
#######################################################################################################

/* ----------------------------------------------------------------------------------------------------
                                           가독성을 위한 출력결과 옵션
---------------------------------------------------------------------------------------------------- */

-- 출력결과 테두리 옵션(가독성)
\pset border 2;

-- 옵션없이 조회
wavdb=# select * from pg_constraint where contype = 'f';
      conname       | connamespace | contype | condeferrable | condeferred | convalidated | conrelid | contypid | conindid | confrelid | confupdtype | confdeltype | confmatchtype | conislocal | coninhcount | connoinherit | conkey | confkey | conpfeqop | conppeqop | conffeqop | conexclop | conbin | consrc
--------------------+--------------+---------+---------------+-------------+--------------+----------+----------+----------+-----------+-------------+-------------+---------------+------------+-------------+--------------+--------+---------+-----------+-----------+-----------+-----------+--------+--------
 fk_vod_byp_info    |       263696 | f       | f             | f           | t            |   263863 |        0 |   263996 |    263854 | a           | a           | s             | t          |           0 | t            | {2}    | {1}     | {98}      | {98}      | {98}      |           |        |
 fk_vod_cmmn_cd_dtl |       263696 | f       | f             | f           | t            |   263872 |        0 |   264002 |    263869 | a           | a           | s             | t          |           0 | t            | {3}    | {1}     | {98}      | {98}      | {98}      |           |        |
 fk_vod_goods       |       263696 | f       | f             | f           | t            |   263878 |        0 |   264012 |    263905 | a           | a           | s             | t          |           0 | t            | {4}    | {1}     | {98}      | {98}      | {98}      |           |        |
 fk_vod_optn        |       263696 | f       | f             | f           | t            |   263896 |        0 |   264006 |    263878 | a           | a           | s             | t          |           0 | t            | {11}   | {1}     | {1752}    | {1752}    | {1752}    |           |        |
 fk_vod_byp_info    |       282534 | f       | f             | f           | t            |   282765 |        0 |   282888 |    282756 | a           | a           | s             | t          |           0 | t            | {2}    | {1}     | {98}      | {98}      | {98}      |           |        |
 fk_vod_cmmn_cd_dtl |       282534 | f       | f             | f           | t            |   282774 |        0 |   282894 |    282771 | a           | a           | s             | t          |           0 | t            | {3}    | {1}     | {98}      | {98}      | {98}      |           |        |
 fk_vod_goods       |       282534 | f       | f             | f           | t            |   282780 |        0 |   282904 |    282807 | a           | a           | s             | t          |           0 | t            | {4}    | {1}     | {98}      | {98}      | {98}      |           |        |
 fk_vod_optn        |       282534 | f       | f             | f           | t            |   282798 |        0 |   282898 |    282780 | a           | a           | s             | t          |           0 | t            | {11}   | {1}     | {1752}    | {1752}    | {1752}    |           |        |
(8개 행)


-- 옵션 적용 후  조회
wavdb=# select * from pg_constraint where contype = 'f';
+--------------------+--------------+---------+---------------+-------------+--------------+----------+----------+----------+-----------+-------------+-------------+---------------+------------+-------------+--------------+--------+---------+-----------+-----------+-----------+-----------+--------+--------+
|      conname       | connamespace | contype | condeferrable | condeferred | convalidated | conrelid | contypid | conindid | confrelid | confupdtype | confdeltype | confmatchtype | conislocal | coninhcount | connoinherit | conkey | confkey | conpfeqop | conppeqop | conffeqop | conexclop | conbin | consrc |
+--------------------+--------------+---------+---------------+-------------+--------------+----------+----------+----------+-----------+-------------+-------------+---------------+------------+-------------+--------------+--------+---------+-----------+-----------+-----------+-----------+--------+--------+
| fk_vod_byp_info    |       263696 | f       | f             | f           | t            |   263863 |        0 |   263996 |    263854 | a           | a           | s             | t          |           0 | t            | {2}    | {1}     | {98}      | {98}      | {98}      |           |        |        |
| fk_vod_cmmn_cd_dtl |       263696 | f       | f             | f           | t            |   263872 |        0 |   264002 |    263869 | a           | a           | s             | t          |           0 | t            | {3}    | {1}     | {98}      | {98}      | {98}      |           |        |        |
| fk_vod_goods       |       263696 | f       | f             | f           | t            |   263878 |        0 |   264012 |    263905 | a           | a           | s             | t          |           0 | t            | {4}    | {1}     | {98}      | {98}      | {98}      |           |        |        |
| fk_vod_optn        |       263696 | f       | f             | f           | t            |   263896 |        0 |   264006 |    263878 | a           | a           | s             | t          |           0 | t            | {11}   | {1}     | {1752}    | {1752}    | {1752}    |           |        |        |
| fk_vod_byp_info    |       282534 | f       | f             | f           | t            |   282765 |        0 |   282888 |    282756 | a           | a           | s             | t          |           0 | t            | {2}    | {1}     | {98}      | {98}      | {98}      |           |        |        |
| fk_vod_cmmn_cd_dtl |       282534 | f       | f             | f           | t            |   282774 |        0 |   282894 |    282771 | a           | a           | s             | t          |           0 | t            | {3}    | {1}     | {98}      | {98}      | {98}      |           |        |        |
| fk_vod_goods       |       282534 | f       | f             | f           | t            |   282780 |        0 |   282904 |    282807 | a           | a           | s             | t          |           0 | t            | {4}    | {1}     | {98}      | {98}      | {98}      |           |        |        |
| fk_vod_optn        |       282534 | f       | f             | f           | t            |   282798 |        0 |   282898 |    282780 | a           | a           | s             | t          |           0 | t            | {11}   | {1}     | {1752}    | {1752}    | {1752}    |           |        |        |
+--------------------+--------------+---------+---------------+-------------+--------------+----------+----------+----------+-----------+-------------+-------------+---------------+------------+-------------+--------------+--------+---------+-----------+-----------+-----------+-----------+--------+--------+
(8개 행)



/* ----------------------------------------------------------------------------------------------------
                                         psql 상에서 디렉토리 경로 변경
---------------------------------------------------------------------------------------------------- */

\cd 디렉토리



/* ----------------------------------------------------------------------------------------------------
                                         port, addr, version 조회
---------------------------------------------------------------------------------------------------- */

select inet_server_port();
select inet_server_addr();
select version();


/* ----------------------------------------------------------------------------------------------------
                                        파라미터 값 변경
---------------------------------------------------------------------------------------------------- */

-- 세션레벨 (SESSION LEVEL; 반영구)
set maintenance_work_mem to '사이즈';
ex) set maintenance_work_mem to '10GB';


/* ----------------------------------------------------------------------------------------------------
                                            컨피그 설정 적용
---------------------------------------------------------------------------------------------------- */

-- 1) OS상에서 적용
pg_ctl -D 데이터경로 reload

-- 2) DB상에서 적용
select pg_reload_conf();


/* ----------------------------------------------------------------------------------------------------
                                             DB프로세스 확인
---------------------------------------------------------------------------------------------------- */

ps -ef | egrep -i 'edb-post|process' | grep -v egrep



/* ----------------------------------------------------------------------------------------------------
                                어떤 데이터베이스를 많이 쓰는지 확인하는 방법
---------------------------------------------------------------------------------------------------- */

select datname,xact_commit,xact_rollback,tup_inserted,tup_updated,tup_deleted from pg_stat_database order by tup_inserted desc;

-- 컬럼의미
datid : 데이터 베이스 OID
datname : 데이터베이스 이름
numbackends : 활성화된 서버프로세스 개수
xact_commit : 데이터베이스에서 커밋된 트랜잭션 개수
xact_rollback : 데이터베이스에서 롤백된 트랜잭션 개수
blks_read : 읽힌 총 디스크 블록 수
blks_hit : 총 버퍼 히트 수
tup_returned : 반환된 로우(row) 개수
tup_fetched : 가져간 로우(row) 개수
tup_inserted : insert되어진 로우(row) 개수
tup_updated : update 되어진 로우(row) 개수
tup_deleted : delete 되어진 로우(row) 개수



/* ----------------------------------------------------------------------------------------------------
                         베큠 통계정보 확인(VACUUM ANALYZE 명령어 실행 시 갱신 됨)
---------------------------------------------------------------------------------------------------- */

select * from pg_stat_all_tables order by schemaname, relname;





/* ----------------------------------------------------------------------------------------------------
                                              힌트(HINT)
---------------------------------------------------------------------------------------------------- */

--FULL SCAN
: select ~~ from 절 사이에 /*+ FULL(테이블명) */ 을 넣어준다
select /*+ FULL(테이블명) */ * from ~~

--NO INDEX
: select /*+ NO_INDEX(테이블명 pk명) */ * from ~~


/* ----------------------------------------------------------------------------------------------------
                                        INDEX 예상 사이즈 확인
---------------------------------------------------------------------------------------------------- */

인덱스 사이즈 = 테이블컬럼 type사이즈 * rows
ex) character varying(20), character varying(10) --> (20 + 10) * 20 (rows) = 600


/* ----------------------------------------------------------------------------------------------------
                                       실행계획(explain)
---------------------------------------------------------------------------------------------------- */

explain (analyze true, verbose true, costs true, buffers true, timing true);



/* ----------------------------------------------------------------------------------------------------
               어디에서 접속해서 어느 데이터베에스에 무슨 쿼리를 쓰고 있는지 확인
---------------------------------------------------------------------------------------------------- */

select datname, usename, current_query from pg_stat_activity;


/* ----------------------------------------------------------------------------------------------------
                    데이터베이스의 insert,update, delete 삭제 개수를 알 수 있다
---------------------------------------------------------------------------------------------------- */

select sum(n_tup_ins), sum(n_tup_upd), sum(n_tup_del) from pg_stat_all_tables;



/* ----------------------------------------------------------------------------------------------------
                                      데이터베이스별 크기 조회
---------------------------------------------------------------------------------------------------- */

select oid, datname from pg_database;
--> 나온 oid 값을 base 디렉토리 밑에서 사이즈 확인







